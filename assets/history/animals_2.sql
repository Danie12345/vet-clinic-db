-- create table owners(
--     id int generated by default as identity (start with 1 increment by 1),
--     full_name text not null,
--     age int not null,
--     primary key (id)
-- );

-- create table species(
--     id int generated by default as identity (start with 1 increment by 1),
--     name text not null,
--     primary key (id)
-- );

-- select * from animals
-- order by id;
-- alter table animals
-- drop species;
-- select * from animals;
-- alter table animals
--     add column species_id int
--     references species(id);
-- alter table animals
--     add column owners_id int
--     references owners(id);

-- insert into 
--     owners (full_name, age)
-- values
--     ('Sam Smith', 34),
--     ('Jennifer Orwell', 19),
--     ('Bob', 45),
--     ('Melody Pond', 77),
--     ('Dean Winchester', 14),
--     ('Jodie Whittaker', 38);

-- insert into
--     species (name)
-- values
--     ('Pokemon'),
--     ('Digimon');

-- update animals
-- set species_id = (
--     select id from species
--     where name = 'Digimon'
-- )
-- where substring(name, position('mon' in name),3) = 'mon'
-- update animals
-- set species_id = (
--     select id from species
--     where name = 'Pokemon'
-- )
-- where substring(name, position('mon' in name),3) != 'mon';

-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Sam Smith'
-- )
-- where name = 'Agumon';
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Jennifer Orwell'
-- )
-- where name in ('Gabumon', 'Pikachu');
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Bob'
-- )
-- where name in ('Devimon', 'Plantmon');
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Melody Pond'
-- )
-- where name in ('Charmander', 'Squirtle', 'Blossom');
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Dean Winchester'
-- )
-- where name in ('Angemon', 'Boarmon');

-- select * from animals
-- order by id;
-- alter table animals
-- drop species;
-- select * from animals;
-- alter table animals
--     add column species_id int
--     references species(id);
-- alter table animals
--     add column owners_id int
--     references owners(id);

-- insert into 
--     owners (full_name, age)
-- VALUES
--     ('Sam Smith', 34),
--     ('Jennifer Orwell', 19),
--     ('Bob', 45),
--     ('Melody Pond', 77),
--     ('Dean Winchester', 14),
--     ('Jodie Whittaker', 38);

-- insert into
--     species (name)
-- values
--     ('Pokemon'),
--     ('Digimon');

-- update animals
-- set species_id = (
--     select id from species
--     where name = 'Digimon'
-- )
-- where substring(name, position('mon' in name),3) = 'mon'
-- update animals
-- set species_id = (
--     select id from species
--     where name = 'Pokemon'
-- )
-- where substring(name, position('mon' in name),3) != 'mon';
    
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Sam Smith'
-- )
-- where name = 'Agumon';
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Jennifer Orwell'
-- )
-- where name in ('Gabumon', 'Pikachu');
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Bob'
-- )
-- where name in ('Devimon', 'Plantmon');
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Melody Pond'
-- )
-- where name in ('Charmander', 'Squirtle', 'Blossom');
-- update animals
-- set owners_id = (
--     select id from owners
--     where full_name = 'Dean Winchester'
-- )
-- where name in ('Angemon', 'Boarmon');

-- select name from animals
-- join owners
--     on animals.owners_id = (
--         select id from owners
--         where full_name = 'Melody Pond'
--     )
-- group by name;

-- select animals.name from animals
-- join species
--     on animals.species_id = (
--         select id from species
--         where name = 'Pokemon'
--     )
-- group by animals.name;

-- select o.full_name as owner, a.name as pet from owners o
-- full join animals a
--     on a.owners_id = o.id;


-- select c.species, count(c.species) from (
--     select s.name as species, a.name as animal from species s
--     full join animals a
--         on a.species_id = s.id
-- ) as c
-- group by c.species;

-- select * from (
--     select id from owners
--     where full_name = 'Jennifer Orwell'
-- ) as f;

-- select pet from (
--     select o.full_name as owner, a.name as pet, s.name as species from owners o
--     join animals a
--         on a.owners_id = o.id
--     join species s
--         on a.species_id = s.id
-- ) as foo
-- where owner = 'Jennifer Orwell' and species = 'Digimon';

-- select pet from (
--     select o.full_name as owner, a.name as pet, a.escape_attempts as escapes from owners o
--     join animals a
--         on a.owners_id = o.id
-- ) as foo
-- where owner = 'Dean Winchester' and escapes = 0;

-- select * from (
--     select count(o.full_name), o.full_name as owner, a.name as pet from owners o
--     full join animals a
--         on a.owners_id = o.id
--     group by owner, pet
-- ) as f;

-- select owner, count(*) as "pets count" from (
--     select count(o.full_name), o.full_name as owner, a.name as pet from owners o
--     full join animals a
--         on a.owners_id = o.id
--     group by owner, pet
-- ) as f
-- group by owner
-- order by "pets count" desc
-- limit 1;